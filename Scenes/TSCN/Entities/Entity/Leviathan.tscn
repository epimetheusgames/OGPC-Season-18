[gd_scene load_steps=6 format=3 uid="uid://bn4kt5yw10r8y"]

[ext_resource type="Script" path="res://Scripts/Components/Rope/FabrikRope.gd" id="1_7l8up"]
[ext_resource type="PackedScene" uid="uid://dwxcjl4jrkyw3" path="res://Scenes/TSCN/Entities/Entity/LeviathanNode.tscn" id="1_ljr6s"]
[ext_resource type="Script" path="res://Scripts/ResourceScripts/EntityBehavior/EnemyBehaviorSettings.gd" id="1_txg70"]

[sub_resource type="GDScript" id="GDScript_pigha"]
script/source = "class_name Leviathan
extends Enemy

@export var LEVIATHAN_NODE: PackedScene

@export var length: float = 1000

@onready var start_node: LeviathanNode = $\"Head\"
@onready var rope_component: FabrikRope = $\"FabrikRope\"

@onready var leviathan_nodes: Array[LeviathanNode] = [start_node]

func _ready() -> void:
	for i in range(rope_component.point_amount):
		var new_node: LeviathanNode = LEVIATHAN_NODE.instantiate()
		
		new_node.set_target_node(leviathan_nodes[i])
		
		add_child(new_node)
		leviathan_nodes.append(new_node)

func _physics_process(delta: float) -> void:
	global_position = get_global_mouse_position()
	$Head.rotation = rope_component.points[0].angle_to_point(rope_component.points[1]) + PI
	leviathan_nodes[-1].visible = false
	rope_component.start_pos = get_global_mouse_position()
	
	for i in range(leviathan_nodes.size() - 1):
		leviathan_nodes[i].global_position = rope_component.points[i]
"

[sub_resource type="Resource" id="Resource_mnlvr"]
script = ExtResource("1_txg70")
health = 100
damage = 0
base_speed = 0.0
agressiveness = 0.0
attack_distance = 0.0
closest_distance = 0.0
sensor_type = 0
wander_type = 0
attack_mode = 0
wander_range = 100.0
view_range = 106.608
view_distance = 0.0
disable_period_length = 1.0
sound_max_distance = 0.0

[node name="Leviathan" type="CharacterBody2D"]
script = SubResource("GDScript_pigha")
LEVIATHAN_NODE = ExtResource("1_ljr6s")
settings = SubResource("Resource_mnlvr")

[node name="Head" parent="." instance=ExtResource("1_ljr6s")]
is_start_node = true

[node name="Polygon2D" parent="Head" index="0"]
polygon = PackedVector2Array(-40, 2, -38, -32, -18, -36, 7, -43, 26, -35, 44, -12, 44, 17, 25, 38, 1, 39, -31, 35)

[node name="Polygon2D3" type="Polygon2D" parent="Head"]
position = Vector2(-36, -9)
scale = Vector2(1.1, 0.486486)
color = Color(0, 0, 1, 1)
polygon = PackedVector2Array(47.4545, -41.3333, 72, 3.88889, 50.1818, -4.33334, 39.2727, -6.38889)

[node name="Polygon2D2" type="Polygon2D" parent="Head"]
position = Vector2(-29, -11)
color = Color(0, 0, 1, 1)
polygon = PackedVector2Array(50, 16, 72, 8, 50, 45, 42, 33)

[node name="FabrikRope" type="Node2D" parent="." node_paths=PackedStringArray("start_anchor_node")]
script = ExtResource("1_7l8up")
point_amount = 20
point_separation = 50.0
start_anchor_node = NodePath("../Head")
component_container = NodePath("..")

[editable path="Head"]
